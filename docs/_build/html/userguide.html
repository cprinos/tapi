

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; tapi 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'0.1',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="tapi 0.1 documentation" href="index.html"/>
        <link rel="next" title="Examples" href="examples.html"/>
        <link rel="prev" title="Quick Start" href="quickstart.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> tapi</a>
        <form class="wy-form" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="why.html">Why use TAPI?</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fundamentals">Fundamentals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#primary-elements">Primary Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overall-structure">Overall Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tapi-expressions">Tapi Expressions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#simple1">Simple1</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#simple2">Simple2</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#simple3">Simple3</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#simple4">Simple4</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#intermediate1">Intermediate1</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#intermediate2">Intermediate2</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#advanced1">Advanced1</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#advanced2">Advanced2</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#advanced3">Advanced3</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#advanced4">Advanced4</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#advanced5">Advanced5</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="source.html">Source</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">tapi</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">User Guide</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>Unit tests in TAPI are specified via a json file. i.e. You specify the input and describe what the output should look
like. (Optionally specifying some confirmation steps as well)</p>
<p>The default name of the json file is tapi.json. However, you could name it something diferrent and run it like:</p>
<blockquote>
<div>python tapi.py -c &lt;my_new_config&gt;.json</div></blockquote>
<p>By default the above will also verify that the provided json file has the correct format and all required key/values are present etc.
If you only wish to verify the json file and not run any tests:</p>
<blockquote>
<div>python tapi.py -c &lt;my_new_config&gt;.json -v</div></blockquote>
<p>You can also specify which test you wish to run by providing their ids: (default is to run all tests)</p>
<blockquote>
<div>python tapi.py -c &lt;my_new_config&gt;.json -i id1,id2,id3</div></blockquote>
<p>See python tapi.py &#8211;help for more details.</p>
<div class="section" id="fundamentals">
<h2>Fundamentals<a class="headerlink" href="#fundamentals" title="Permalink to this headline">¶</a></h2>
<p>The fundamental elements in a tapi.json file is the request/response elements. A request element looks like:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;some url&gt;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;verb&quot;</span><span class="o">:</span> <span class="s2">&quot;get&quot;</span><span class="p">,</span>
        <span class="s2">&quot;headers&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;header_key1&quot;</span><span class="o">:</span> <span class="s2">&quot;header_value1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;header_key2&quot;</span><span class="o">:</span> <span class="s2">&quot;header_value2&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;payload_key1&quot;</span><span class="o">:</span> <span class="s2">&quot;payload_value1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;payload_key2&quot;</span><span class="o">:</span> <span class="s2">&quot;payload_value2&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The only required field in the above is the &#8216;url&#8217; field. The above snippet will cause a GET request to be made to the url
&lt;some url&gt; along with headers as in the field &#8216;headers&#8217; and the &#8216;payload&#8217; form encoded.</p>
<p>The &#8216;verb&#8217; defaults to GET. Other possible values are POST/PUT/DELETE</p>
<p>A response element looks like:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;response&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;status_code&quot;</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;headers&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;header_key1&quot;</span><span class="o">:</span> <span class="s2">&quot;header_value1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;header_key2&quot;</span><span class="o">:</span> <span class="s2">&quot;header_value2&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;body&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;$.name&quot;</span><span class="o">:</span> <span class="s2">&quot;foobar&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The response subsection is typically optional. Add it if you need to check something other than the defaults. The default status_code is 200. The block causes the framework to verify that the response received after making the HTTP request (as
defined by the &#8216;request&#8217; section) matches the values specified. If it does not, a failure is reported.</p>
</div>
<div class="section" id="primary-elements">
<h2>Primary Elements<a class="headerlink" href="#primary-elements" title="Permalink to this headline">¶</a></h2>
<p>There are 4 main primary subsections in a test:</p>
<ol class="arabic simple">
<li>startup</li>
<li>main</li>
<li>confirm</li>
<li>teardown</li>
</ol>
<p>A startup section is a list of main/confirm subsections. These are run in order before any test. The idea is to do any
setup like functionality in these blocks. It is always optional.</p>
<p>A main subsection details the api being tested. It is the only required subsection in any test.</p>
<p>A confirm subsection typically is an api call to confirm that the api being tested actually did the work. e.g. if you are
testing any api to add a user, a confirm subsection could do a GET on that user to ensure that the user was actually added.
It is always optional.</p>
<p>A teardown is run at the end of each test. It is to perform any possible cleanup action you may have. it is always optional.</p>
</div>
<div class="section" id="overall-structure">
<h2>Overall Structure<a class="headerlink" href="#overall-structure" title="Permalink to this headline">¶</a></h2>
<p>The tapi.json file has the following overall structure:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;heading&quot;</span><span class="o">:</span> <span class="s2">&quot;Some heading for what you are testing&quot;</span><span class="p">,</span>
  <span class="s2">&quot;base_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://api.example.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;common&quot;</span><span class="o">:</span> <span class="p">{...},</span>
  <span class="s2">&quot;on_failure&quot;</span><span class="o">:</span> <span class="s2">&quot;continue&quot;</span><span class="p">,</span>
  <span class="s2">&quot;startup_harness&quot;</span><span class="o">:</span> <span class="p">[...],</span>
  <span class="s2">&quot;teardown_harness&quot;</span><span class="o">:</span> <span class="p">[...],</span>
  <span class="s2">&quot;tests&quot;</span><span class="o">:</span> <span class="p">[...]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The field descriptions are as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="7%" />
<col width="9%" />
<col width="9%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Required</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>heading</td>
<td>string</td>
<td>None</td>
<td>No</td>
<td>a human friendly name for this test suite</td>
</tr>
<tr class="row-odd"><td>base_url</td>
<td>string</td>
<td>None</td>
<td>No</td>
<td>the base url to prepend to every url path specified in the tests</td>
</tr>
<tr class="row-even"><td>common</td>
<td>dict</td>
<td>{}</td>
<td>No</td>
<td>common parameters for requests/response</td>
</tr>
<tr class="row-odd"><td>on_failure</td>
<td>string</td>
<td>continue</td>
<td>No</td>
<td>action in case of failure. (continue/abort)</td>
</tr>
<tr class="row-even"><td>startup_harness</td>
<td>list</td>
<td>[]</td>
<td>No</td>
<td>actions to perform before the run begins</td>
</tr>
<tr class="row-odd"><td>teardown_harness</td>
<td>list</td>
<td>[]</td>
<td>No</td>
<td>actions to perform after the test run</td>
</tr>
<tr class="row-even"><td>tests</td>
<td>list</td>
<td>[]</td>
<td>Yes</td>
<td>tests to be run</td>
</tr>
</tbody>
</table>
<p>The following subsections will detail the individual compound keys. (ROOT indicates the root of the json structure.)</p>
<div class="section" id="root-common">
<h3>ROOT:common<a class="headerlink" href="#root-common" title="Permalink to this headline">¶</a></h3>
<p>This element contains all the request params that will be common to all requests made by Tapi. It can also contain a response section that can contain all data that needs to be validated. Here is a sample:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;headers&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;accept-encoding&quot;</span><span class="o">:</span> <span class="s2">&quot;compress, gzip&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="s2">&quot;response&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;status_code&quot;</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s2">&quot;headers&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;content-type&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above snippet will send the accept-encoding header to &#8216;compress, gzip&#8217; in every request made by Tapi (unless overidden in the test config itself). When a response arrives, it will check if the status code is 200 and the response header content-type is set to &#8216;application/json&#8217;. Else a failure is recorded.</p>
</div>
<div class="section" id="root-on-failure">
<h3>ROOT:on_failure<a class="headerlink" href="#root-on-failure" title="Permalink to this headline">¶</a></h3>
<p>This determines what should be done in case a test fails. Possible values are &#8216;continue&#8217; and &#8216;abort&#8217;</p>
</div>
<div class="section" id="root-startup-harness">
<h3>ROOT:startup_harness<a class="headerlink" href="#root-startup-harness" title="Permalink to this headline">¶</a></h3>
<p>These are API calls that are made before the test run. It&#8217;s called only once during the entire run at the beginning. A sample harness is as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[{</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://api.example.com/init1&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://api.example.com/init2&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://api.example.com/init3&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Note that the response status code is verified by default. If any request fails, the tests do not begin.</p>
</div>
<div class="section" id="root-teardown-harness">
<h3>ROOT:teardown_harness<a class="headerlink" href="#root-teardown-harness" title="Permalink to this headline">¶</a></h3>
<p>These are API calls that are made after all tests run. It&#8217;s essentialy a list of &#8216;ROOT:common&#8217; sections. It&#8217;s called only once during the entire run at the end. A sample harness is as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[{</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://api.example.com/cleanup1&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://api.example.com/cleanup2&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://api.example.com/cleanup3&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Note that the response status code is verified by default. If any request fails, the test run is indicated as a failure.</p>
</div>
<div class="section" id="root-tests">
<h3>ROOT:tests<a class="headerlink" href="#root-tests" title="Permalink to this headline">¶</a></h3>
<p>This is essentially the meat of the framework. It&#8217;s where all the requests to test each endpoint is specified. It contains a list of sections wherein each section specifies how an endpoint should be requested and how the response should be verfied. Here is an example of a individual test:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;new user&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;new_user&quot;</span><span class="p">,</span>
    <span class="s2">&quot;startup&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;/startup&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;verb&quot;</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;/endpoint&quot;</span><span class="p">,</span>
          <span class="s2">&quot;verb&quot;</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span>
          <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>
            <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="s2">&quot;20&quot;</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;response&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;status_code&quot;</span><span class="o">:</span> <span class="mi">201</span><span class="p">,</span>
            <span class="s2">&quot;headers&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;auth-token&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span>
            <span class="p">}</span>
            <span class="s2">&quot;body&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;$.name&quot;</span><span class="o">:</span> <span class="s2">&quot;bob&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;confirm&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;/endpoint/[[self._.response.body.name]]&quot;</span>
              <span class="p">},</span>
              <span class="s2">&quot;response&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;body&quot;</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s2">&quot;$.name&quot;</span><span class="o">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;$.age&quot;</span><span class="o">:</span> <span class="s2">&quot;20&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;teardown&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;/teardown&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;verb&quot;</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The field descriptions are as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Required</th>
<th class="head" colspan="2">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>name</td>
<td>string</td>
<td>None</td>
<td>Yes</td>
<td colspan="2">a human friendly name for the test</td>
</tr>
<tr class="row-odd"><td>id</td>
<td>string</td>
<td>None</td>
<td>No</td>
<td colspan="2">unique id to identify this test.</td>
</tr>
<tr class="row-even"><td>startup</td>
<td>list</td>
<td>None</td>
<td>No</td>
<td colspan="2">list of endpoints to call before running the test</td>
</tr>
<tr class="row-odd"><td>teardown</td>
<td>list</td>
<td>None</td>
<td>No</td>
<td colspan="2">list of endpoints to call after running the test</td>
</tr>
<tr class="row-even"><td>request</td>
<td>dict</td>
<td>None</td>
<td>Yes</td>
<td colspan="2"><p class="first">request object. Possible keys are:</p>
<p>url - url to test (Required)</p>
<p>verb - HTTP verb (defaults to GET) (Optional)</p>
<p>headers - dict of header key/value pairs (Optional)</p>
<p class="last">payload - dict of key/value pairs or a string (Optional). If a dict is given, it will
be url-encoded. If string, it will be used as is.</p>
</td>
</tr>
<tr class="row-odd"><td>response</td>
<td>dict</td>
<td>None</td>
<td>No</td>
<td colspan="2"><p class="first">response object to be verified. Possible keys are:</p>
<p>status_code - what should the response code be? (default 200) (Optional)</p>
<p>headers - dict of response header key/value pairs that need to match (Optional)</p>
<dl class="last docutils">
<dt>body - dict of key/value pairs that need to match (Optional) Use the</dt>
<dd><a class="reference external" href="https://github.com/kennknowles/python-jsonpath-rw">jsonpath-rw</a> spec
to match values in the body.</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td>confirm</td>
<td>dict</td>
<td>None</td>
<td>No</td>
<td colspan="2">confirm that the API request just worked. It consists of a request/response block.
e.g. if the request block was adding a user, the response block would have verfied it,
the confirm block can be used to do a GET at the final user endpoint to confirm that
user was indeed added.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="tapi-expressions">
<h2>Tapi Expressions<a class="headerlink" href="#tapi-expressions" title="Permalink to this headline">¶</a></h2>
<p>In so happens sometimes that the values of fields need to be computed and are not readily available. e.g. we may want
to add an &#8216;authorization&#8217; header with has the sha256 hash of the username:password or something similar. In order to facilitate
such situations, you can use Script Tapi Expressions. These are essentially python scripts that take some parameters and output a result.</p>
<p>There are three types of Script Tapi Expressions, one for requests, one for responses and one for tokens. The one for requests always returns a value which is used in the HTTP request. The script for response is one that takes some args and always returns True/False i.e. telling us if the response matched the spec or not.</p>
<p>A sample request tapi expression is like:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.api.example.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;some_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;verb&quot;</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span>
            <span class="s2">&quot;headers&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;authorization&quot;</span><span class="o">:</span> <span class="s2">&quot;[[script:request_some_id_authorization.py]]&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="s2">&quot;[[script:request_some_id_payload.py]]&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The framework will then look for the script request_some_id_authorization.py/request_some_id_payload.py in the same directory as the tapi.json (or whatever you have named your config as) and execute it. The return value of the script is then used when making the HTTP request.</p>
<p>The request scripts should have this general form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RequestRunner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">test_output_so_far</span><span class="p">,</span> <span class="n">config_data</span><span class="p">):</span>

        <span class="c">#do whatever you need here...</span>

        <span class="k">return</span> <span class="s">&#39;some value&#39;</span>
</pre></div>
</div>
<p>The framework will import RequestRunner and calls method get_value. The argument test_output_so_far is a dict of the test
request/response results of any previous subsections so far e.g. startup, main subsections etc. The config_data is the json
config of the test under consideration. Thus this function has all the info it needs and it can do whatever logic it wants to do
and finally return a result to be used as a value in the HTTP request.</p>
<p>Similarly the response tapi script has the form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ResponseRunner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">test_output_so_far</span><span class="p">,</span> <span class="n">test_config_data</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The framework will import ResponseRunner and call method validate. Args provided include the HTTP response object. The script
can then do any calculation it neds and finally return a True/False answer.</p>
<p>Sometimes, we would also like to access the value of a previously calculated header in future subsections. e.g. the first time
you login, if you get a auth-token. And later in every subsequent API call, you need to specify that auth-token, you can use a token tapi expression:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.api.example.com/login&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;some_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;verb&quot;</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span>
            <span class="s2">&quot;payload&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;username&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span><span class="o">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;response&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;headers&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;auth-token&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;confirm&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.api.example.com/dashboard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;headers&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;auth-token&quot;</span><span class="o">:</span> <span class="s2">&quot;[[token:main.response.headers.auth-token]]&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The [[token:main.response.headers.auth-token]] tells the framework that the auth-token value should be the same as in the
response header from the initial request. Note the asterix in the first api response. This tells the tapi framework to only
check for the existence of the key, any value returned by the server is ok.</p>
<p>Finally, you can also access environment vaiables by using a tapi expression like [[env:$USERNAME]] - this will be replaced
by the value of the $USERNAME environment variable.</p>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral" title="Quick Start"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2014, Jimmy John.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>